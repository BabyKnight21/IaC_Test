---
- name: Check router health
  cisco.ios.ios_facts:
    gather_subset: all

- name: Display router health
  debug:
    msg:
    - "Hostname: {{ ansible_net_hostname }} has {{ ansible_net_cpu_utilization }}"

- name: Create stat of hosts to add to critical_inventory
  when: not cpu_pass
  set_stats:
    date:
      hosts_to_add: "{{ hosts_to_add | default([]) + [item] }}"
    with_item:
      -"{{ inventory_hostname }}"